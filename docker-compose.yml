version: '3.8'

services:
  backend:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: nexthire-api
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - BACKEND_PORT=3000
      - MONGODB_URL=mongodb+srv://rajan:kumar@cluster0.vvtoxbl.mongodb.net/JobPortal?retryWrites=true&w=majority&appName=Cluster0
      - GOOGLE_GENERATIVE_AI_API_KEY=AIzaSyCKieJDGQIgQyudTu4YY_tt_yZ-IdbIZz0
      - BACKEND_URL=http://nexthireapi.raorajan.pro # CHANGED
      - SERVER_URL=http://nexthireapi.raorajan.pro # CHANGED
      - FRONTEND_URL=http://nexthire.raorajan.pro # CHANGED
      - CLIENT_URL=http://nexthire.raorajan.pro # CHANGED
      - GITHUB_PAGE_URL=https://raorajan.github.io
      - APPLICATION_ID=08b79528
      - APPLICATION_KEY=1ecce46bf2aa3a99de1a68161b092f7e
      - ARBEITNOW_API_URL=https://arbeitnow.com/api/job-board-api
      - COOKIE_EXPIRE=7
      - SUPABASE_URL=https://uhlgoaiewafibnlqeczk.supabase.co
      - SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVobGdvYWlld2FmaWJubHFlY3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NTg0MDcsImV4cCI6MjA3MjQzNDQwN30.ERay7ZPZvwf7HJJEunxz4uUR3ErL2rFl4LbyH2Ij3Po
      - SUPABASE_SERVICE_PRIVATE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVobGdvYWlld2FmaWJubHFlY3prIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg1ODQwNywiZXhwIjoyMDcyNDM0NDA3fQ.8LhKJ1DerOvpi6i8BrT5BHPogmn3sKCWOP4bKetMFoo
      - SUPABASE_SERVICE_PUBLIC_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVobGdvYWlld2FmaWJubHFlY3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NTg0MDcsImV4cCI6MjA3MjQzNDQwN30.ERay7ZPZvwf7HJJEunxz4uUR3ErL2rFl4LbyH2Ij3Po
      - JWT_SECRET=WFFWf15115U842UGUBWF81EE858UYBY51BGBJ5E51Q
      - JWT_EXPIRE=7d
      - SMTP_HOST=smtp.ethereal.email
      - SMTP_PORT=587
      - SMTP_SERVICE=gmail
      - SMTP_MAIL=ethel47@ethereal.email
      - SMTP_PASSWORD=6CEWdsKuKY7dqtpbDJ
      - EMAIL_PASS=fnlqlsihgcpemazq
      - EMAIL_USER=raorajan9576@gmail.com
      - CLOUDINARY_NAME=dcav4norh
      - CLOUDINARY_API_KEY=927914427965528
      - CLOUDINARY_SECRET_KEY=bTTyow9CJWKNWrAyfGk65Rs0YPo
    restart: always
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile
      args:
        - VITE_API_URL=http://nexthireapi.raorajan.pro/ # CHANGED
        - VITE_FRONTEND_URL=http://nexthire.raorajan.pro/ # CHANGED
        - VITE_CLIENT_URL=http://nexthire.raorajan.pro/ # CHANGED
        - VITE_FIREBASE_API_KEY=AIzaSyBlBqVTl5qTuqAFnBURH2UuA4LAOE7bYY8
        - VITE_FIREBASE_AUTH_DOMAIN=job-portal-website-6a198.firebaseapp.com
        - VITE_FIREBASE_PROJECT_ID=job-portal-website-6a198
        - VITE_FIREBASE_STORAGE_BUCKET=job-portal-website-6a198.appspot.com
        - VITE_FIREBASE_MESSAGING_SENDER_ID=232875364591
        - VITE_FIREBASE_APP_ID=1:232875364591:web:ea9ebcfcfb061f19d10b1a
        - VITE_FIREBASE_MEASUREMENT_ID=G-BFBN1SG1HT
        - VITE_APPLICATION_ID=08b79528
        - VITE_APPLICATION_KEY=1ecce46bf2aa3a99de1a68161b092f7e
        - VITE_ADZUNA_API_URL=https://api.adzuna.com/v1/api
        - VITE_SOCIAL_FACEBOOK_URL=https://facebook.com
        - VITE_SOCIAL_TWITTER_URL=https://twitter.com
    container_name: nexthire-app
    ports:
      - "5173:5173" # CHANGED: was "5173:3000"
    restart: always
    depends_on:
      - backend
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M

  nginx:
    image: nginx:alpine
    container_name: nexthire-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - frontend
      - backend
    restart: always
